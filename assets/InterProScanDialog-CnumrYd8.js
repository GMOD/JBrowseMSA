import{u as m,o as f,e as h,R as a,d as k,T as y,B as l}from"./index-vwVwjhbE.js";import{t as g,a as E,j as w}from"./fetchUtils-iNLkv-IC.js";import{D as P}from"./DialogContent-C1qt2eNt.js";import{D as I}from"./DialogActions-Dcg7AJtp.js";const d="https://www.ebi.ac.uk/Tools/services/rest";async function F({seq:r,onProgress:t,onJobId:n,programs:c,model:o}){const i=await g(`${d}/iprscan5/run`,{method:"POST",body:new URLSearchParams({email:"colin.diesh@gmail.com",sequence:r,programs:c.join(",")})});n?.(i),await R({jobId:i,onProgress:t}),await D({jobId:i,model:o})}function A(r){return w(`${d}/iprscan5/result/${r}/json`)}async function R({onProgress:r,jobId:t}){const n=`${d}/iprscan5/status/${t}`;try{for(;;){for(let o=0;o<10;o++)await E(1e3),r({msg:`Checking status ${10-o}`,url:n});const c=await g(n);if(c.includes("FINISHED"))break;if(c.includes("FAILURE"))throw new Error(`Failed to run: jobId ${t}`)}}finally{r()}}async function b({algorithm:r,seq:t,programs:n,onJobId:c,onProgress:o,model:i}){try{throw o({msg:`Launching ${r} MSA`}),r==="interproscan"&&await F({seq:t,onJobId:c,onProgress:o,programs:n,model:i}),new Error("unknown algorithm")}finally{o()}}async function D({jobId:r,model:t}){try{t.setStatus({msg:`Downloading results of ${r} (for larger sequences this can be slow, click status to download and upload in the manual tab)`,url:`https://www.ebi.ac.uk/Tools/services/rest/iprscan5/result/${r}/json`});const n=await A(r);t.setInterProAnnotations(Object.fromEntries(n.results.map(c=>[c.xref[0].id,c]))),t.setShowDomains(!0),m.getSession(t).notify(`Loaded interproscan ${r} results`,"success")}catch(n){console.error(n),m.getSession(t).notifyError(`${n}`,n)}finally{t.setStatus()}}const v=f(function({handleClose:r,model:t}){const[n,c]=h.useState([{name:"NCBIfam",description:"NCBI RefSeq FAMs including TIGRFAMs",category:"Families, domains, sites & repeats",checked:!0},{name:"SFLD",description:"Structure function linkage database",category:"Families, domains, sites & repeats",checked:!0},{name:"Phobius",checked:!0,description:"A combined transmembrane topology and signal peptide predictor",category:"Other sequence features"},{name:"SignalP",checked:!0,category:"Other sequence features"},{name:"SignalP_EUK",category:"Other category",checked:!0},{name:"SignalP_GRAM_POSITIVE",category:"Other category",checked:!0},{name:"SignalP_GRAM_NEGATIVE",checked:!0,category:"Other category"},{name:"SUPERFAMILY",category:"Structural domains",checked:!0},{name:"PANTHER",category:"Families, domains, sites & repeats",checked:!0},{name:"Gene3D",category:"Structural domains",checked:!0},{name:"Hamap",category:"Families, domains, sites & repeats",checked:!0},{name:"ProSiteProfiles",category:"Families, domains, sites & repeats",checked:!0},{name:"ProSitePatterns",category:"Families, domains, sites & repeats",checked:!0},{name:"Coils",category:"Other sequence features",checked:!0},{name:"SMART",category:"Families, domains, sites & repeats",checked:!0},{name:"CDD",description:"Conserved Domains Database",category:"Families, domains, sites & repeats",checked:!0},{name:"PRINTS",category:"Families, domains, sites & repeats",checked:!0},{name:"Pfam",category:"Families, domains, sites & repeats",checked:!0},{name:"MobiDBLite",checked:!0,category:"Other sequence features"},{name:"PIRSF",checked:!0,category:"Other category"},{name:"TMHMM",checked:!0,category:"Other sequence features"},{name:"AntiFam",checked:!0,category:"Other category"},{name:"FunFam",checked:!0,category:"Other category"},{name:"PIRSR",checked:!0,category:"Families, domains, sites & repeats"}]),o=n.filter(e=>e.checked).map(e=>e.name),[i,p]=h.useState(!1);return a.createElement(k.Dialog,{maxWidth:"xl",title:"Query InterProScan API for domains",onClose:()=>{r()},open:!0},a.createElement(P,null,a.createElement(y,null,"This will run InterProScan via the InterProScan API on all rows of the current MSA"),a.createElement(l,{onClick:()=>{p(!i)}},i?"Hide":"Show"," advanced options"),i?a.createElement("div",null,a.createElement(y,null,"Select algorithms for InterProScan to run"),a.createElement("div",null,a.createElement(l,{variant:"contained",color:"secondary",onClick:()=>{c(n.map(e=>({...e,checked:!1})))}},"Select none"),a.createElement(l,{variant:"contained",color:"primary",onClick:()=>{c(n.map(e=>({...e,checked:!0})))}},"Select all")),a.createElement("table",null,a.createElement("tbody",null,n.toSorted((e,s)=>e.category.localeCompare(s.category)).map(({name:e,checked:s,category:S})=>a.createElement("tr",{key:e},a.createElement("td",null,a.createElement("input",{type:"checkbox",key:e,checked:s,onChange:()=>{c(n.map(u=>u.name===e?{...u,checked:!u.checked}:u))}})),a.createElement("td",null,e),a.createElement("td",null,S)))))):null),a.createElement(I,null,a.createElement(l,{variant:"contained",color:"secondary",onClick:()=>{r()}},"Cancel"),a.createElement(l,{variant:"contained",color:"primary",onClick:()=>{(async()=>{try{const{rows:e}=t;if(e.length>140)throw new Error("Too many sequences, please run InterProScan offline");await b({algorithm:"interproscan",programs:o,seq:e.map(s=>[s[0],s[1].replaceAll("-","")]).filter(s=>!!s[1]).map(s=>`>${s[0]}
${s[1]}`).join(`
`),onProgress:s=>{t.setStatus(s)},model:t})}catch(e){console.error(e),m.getSession(t).notifyError(`${e}`,e)}finally{t.setStatus()}})(),r()}},"Send sequences to InterProScan")))});export{v as default};
//# sourceMappingURL=InterProScanDialog-CnumrYd8.js.map
